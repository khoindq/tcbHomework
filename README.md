# TCB home work 

## Table of Contents

1. [Project Description](#project-description)
1. [Project Structure](#project-structure)
3. [Usage](#usage)
## Project Description

This project is a homework assignment for applying to the position in Techcombank. It involves developing a RESTful API project to showcase backend development skills and API design expertise. The project focuses on creating a robust and scalable API solution. 

The solution is based on clean architecture design and consists of four main layers:

1. Model: This layer includes the definition of the objects and their validation across the rest of the layers.
2. Storage: The storage layer manages the operation on model object (read find write operations)

3. Business Layer (Repository Layer): This layer handles the business logic and acts as a repository for data. the storage interface is defined similarly to the storage layer. and we can use the interfacet to implement mock testing operation 
4. Transportation Layer: The transportation layer deals with the communication between the API and external clients.

To ensure resiliency, the rate limiting or authentication should be implemented in the API gateway layer. For larger scale businesses, it is recommended to separate the configuration from this project. Alternatively, for smaller scale businesses, the Krakend D gateway can be consider to used.

During the development process, the Go version 1.19.1 was used.

The swagger document is implemented together with the project. You can access this document by accessing the endpoint `/swagger/index.html` (e.g., http://localhost:8080/swagger/index.html).

The typical success response of the API is embedded inside a common structured defined in the file `common/app_response`. It includes the data filled with child object structures.

The typical error response of the API is embedded inside a common structured defined in the file common/error . it contains the root cause error , http error status code and log message. When in real enviroment this error can be filtered (only allow specific field of error data is exported based on deploy enviroment) but the implementation is not completed due to the limit time of this homework 
The Makefile contains command 
Makehelo --> show the help message
make api-doc --> required (swag - https://github.com/swaggo/swag in installed ) this command generated documentation which is stored in docs/poolservice 
make gen-mock --> generate mocking interface of any interface defination in the priject (require )

## Project Structure

```
├── cmd/
│   ├── poolservice/
│   │   ├── main.go (main program starting point, contain api route for the rest api )
├── common/  (defined common object and its method (application error, application response, application fake db)
├── docs/ docs/ (contains docs generated by `make api-doc` command)
├── middleware (conttain middleware function  of the rest api)
├── module/ (contains middleware functions of the rest api)
├── utils/ (contains functions to calculate the quantile)
├── Makefile.md
└── README.md
```
## Usage:

### Install
- golang: [https://go.dev/doc/install](https://go.dev/doc/install)
- mockery (optional - if you want to generate mock interface): [https://github.com/vektra/mockery](https://github.com/vektra/mockery)
- swag (optional - if you want to generate swag documentation): [https://github.com/swaggo/gin-swagger](https://github.com/swaggo/gin-swagger)

### Run the project
1. Execute the following command: `make poolservice-run`

### Test the project with curl command:
1. Insert or append the pool
    ```bash
    curl -X 'POST' \
      'http://localhost:8080/api/v1/pool/insertorappend' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{
        "poolId": 0,
        "poolValues": [0,2,4,1,4,5,6,9,8]
      }'
    ```
    Response body:
    ```json
    {
      "data": {
        "status": "inserted"
      }
    }
    ```

2. Query the pool
    ```bash
    curl -X 'POST' \
      'http://localhost:8080/api/v1/pool/quantile/get' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{
        "percentile": 50,
        "poolId": 0
      }'
    ```
    Response body:
    ```json
    {
      "data": {
        "totalCount": 9,
        "calculatedQuantile": 4
      }
    }
    ```
You can also test with the Swagger page hosted by the program at http://localhost:8080/swagger/index.html. For other commands (generate docs, generate mock interface), type make help.  